#!/usr/bin/env bash

delete-merged-branches() {
  git branch --merged | grep -wv 'main' | grep -wv 'master' | xargs -n 1 git branch -d
}

main() {
  remote=$(git rev-parse --abbrev-ref origin/HEAD)

  git stash \
    && git fetch --prune \
    && git rebase $remote \
    && delete-merged-branches
}

[ -d .git ] && main || git rev-parse --git-dir > /dev/null 2>&1
