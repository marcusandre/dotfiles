#!/usr/bin/env bash

# Process a given Brewfile with homebrew commands.

# Usage: brew-bundle -f Brewfile
# Author: Marcus Andr√© - https://github.com/marcusandre
# License: MIT

set -e

#
# Print usage information
#

function usage() {
  echo "Usage: brew-bundle -f Brewfile" &&  exit 1
}

#
# Process given file
#

function process() {
  local Brewfile=$1

  # fresh repo
  brew upgrade
  brew update

  while read recipe; do
    brew install $recipe
  done <$Brewfile

  # remove old stuff
  brew cleanup --force
}

#
# Parse <args>
#

if [[ $# -ne 2 || "$1" != "-f" ]]; then
  usage && exit 1
else
  process $2 && exit 0
fi
